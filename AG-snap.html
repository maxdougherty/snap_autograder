<!DOCTYPE html>
<html style="height: 100%">
    <head lang="en">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Snap! Build Your Own Blocks. Beta</title>
        <link rel="shortcut icon" href="http://snap.berkeley.edu/fav3.gif" type="image/gif">

        <link rel="stylesheet" type="text/css" href="AG-snap.css">

        <link rel="stylesheet" src="bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="bootstrap.min.js"></script>
        <script src="http://underscorejs.org/underscore-min.js"></script>

        <script type="text/javascript" src="snap.js"></script>
        <script type="text/javascript" src="snapPLE.js"></script>
        

        <script type="text/javascript">

            //recover stored save
            //var worldXML = localStorage.getItem("worldState");
            var world;


            var id = (window.location != window.parent.location)
            ? document.referrer
            : document.location;

            console.log(id);

            if (id.href.includes("edx.org")) {
                id = null;
            }
            var pageXML = localStorage.getItem(id);

            window.onload = function () {
                world = new WorldMorph(document.getElementById('world'));
                new IDE_Morph().openIn(world);

                //Reduce Stage Size on initialization
                var ide = world.children[0];
                ide.toggleStageSize(true);
                
                //If this page has already been loaded
                if (pageXML !== null) {
                    ide.openProjectString(pageXML);
                }
                setInterval(loop, 1);
            };
            function loop() {
                world.doOneCycle();
            }
        </script>
    </head>
    <body style="margin: 0; height: 100%;">

        <canvas id="world" tabindex="1" style="position: absolute;" /></canvas>
        <!-- <div id="ag_menu" style="position: relative;">
            <button type="button" class="btn btn-default">Default</button>
        </div>
        <div id="ag_feedback" style="position: relative; height: 10%;">
            GIANT TEXT HERE
        </div> -->
    </body>

</html>